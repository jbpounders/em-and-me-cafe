---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getSiteSettings } from '../lib/strapi';

let siteSettings = null;

try {
  siteSettings = await getSiteSettings();
} catch (error) {
  console.error('Failed to fetch site settings:', error);
}

const pageTitle = siteSettings?.siteName
  ? `About | ${siteSettings.siteName}`
  : 'About | Em & Me Vietnamese Cafe & Bites';

// Parse markdown-style content to HTML (basic conversion)
function parseContent(content: string): string {
  if (!content) return '';
  return content
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/\n\n/g, '</p><p>')
    .replace(/^(.+)$/gm, (match) => {
      if (match.startsWith('<h') || match.startsWith('</p>')) return match;
      return match;
    });
}

const aboutContent = siteSettings?.aboutPageContent || `
# Our Story

Em & Mẹ began as a dream shared between a mother and daughter, rooted in the rich culinary traditions of Vietnam. Our name tells our story: Em means "little one" and Mẹ means "mother." When you spell Em backward, you get Me—because at the heart of everything we do is the love between family.

We believe that every cup of Vietnamese coffee and every bite of bánh mì should transport you to the bustling streets of Saigon, while making you feel right at home in Nashville. Our recipes have been passed down through generations, each one carrying memories of family gatherings, late-night conversations, and the simple joy of sharing a meal together.

## Our Mission

To bring authentic Vietnamese flavors to Nashville while creating a warm, welcoming space where everyone feels like family.
`;
---

<Layout title={pageTitle}>
  <main>
    <Header
      siteName={siteSettings?.siteName}
      tagline={siteSettings?.tagline}
      address={siteSettings?.address}
    />

    <section class="about-section">
      <div class="about-content">
        <h1 class="page-title">Our Story</h1>

        <div class="story-text">
          <p class="intro">
            {siteSettings?.ourStoryText || 'Em means "little one." Mẹ means "mother." Spelled backward, Em becomes Me: We are inspired by the vibrant flavors of Vietnam, and the warmth of family.'}
          </p>

          <div class="full-story" set:html={parseContent(aboutContent)} />
        </div>

        <a href="/" class="btn btn-outline">Back to Home</a>
      </div>
    </section>

    <Footer
      siteName={siteSettings?.siteName}
      tagline={siteSettings?.tagline}
    />
  </main>
</Layout>

<style>
  .about-section {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--spacing-xl) var(--spacing-lg);
  }

  .page-title {
    text-align: center;
    margin-bottom: var(--spacing-xl);
    font-size: 2.5rem;
  }

  .story-text {
    background: white;
    padding: var(--spacing-xl);
    border-radius: 8px;
    border: 2px solid var(--color-navy);
    margin-bottom: var(--spacing-xl);
  }

  .intro {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    font-style: italic;
    text-align: center;
    color: var(--color-navy);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--color-cream-dark);
    margin-bottom: var(--spacing-lg);
  }

  .full-story {
    line-height: 1.8;
    color: var(--color-text);
  }

  .full-story :global(h1),
  .full-story :global(h2) {
    color: var(--color-navy);
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-md);
  }

  .full-story :global(h1) {
    font-size: 1.75rem;
  }

  .full-story :global(h2) {
    font-size: 1.5rem;
  }

  .full-story :global(p) {
    margin-bottom: var(--spacing-md);
  }

  .about-section .btn {
    display: block;
    width: fit-content;
    margin: 0 auto;
  }
</style>
